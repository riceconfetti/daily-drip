---
import EventBase from "./EventBase.svelte";
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";

import dayjs from "dayjs";
import relativeTime from "dayjs/plugin/relativeTime.js";
dayjs.extend(relativeTime);

import { getEntry } from "astro:content";
import type { CollectionEntry } from "astro:content";
interface Props {
  event: CollectionEntry<"events">;
}

const { event } = Astro.props;

let eventDetails = event.data;
//let character;
eventDetails.game = await getEntry(event.data.game);

if (event.data.type == "banner") {
  let character = await getEntry(event.data.character);
  eventDetails.title = character.data.bannerName;
  eventDetails.image = character.data.images.bannerCard;
  eventDetails.colors = character.data.colors;
}

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/images/characters/**/*.{jpeg,jpg,png,gif}"
);

if (!images[eventDetails.image])
  throw new Error(
    `"${eventDetails.image}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`
  );
---

<EventBase {eventDetails} client:load>
  <Image
    src={images[eventDetails.image]()}
    class="absolute -right-20 top-0 h-full w-auto"
    alt={`${eventDetails.title} Banner Card`}
  />
</EventBase>
