---
import { Image } from "astro:assets";
import type { ImageMetadata } from "astro";
import dayjs from "dayjs";
import relativeTime from "dayjs/plugin/relativeTime.js";
dayjs.extend(relativeTime);
const { character, event, imagePath } = Astro.props;

const images = import.meta.glob<{ default: ImageMetadata }>(
  "/src/assets/images/characters/**/*.{jpeg,jpg,png,gif}"
);

if (!images[imagePath])
  throw new Error(
    `"${imagePath}" does not exist in glob: "src/assets/*.{jpeg,jpg,png,gif}"`
  );

const eventType = dayjs(event.startDate) > dayjs() ? "Starting" : "Ending";
const timeUntil =
  dayjs(event.startDate) > dayjs()
    ? dayjs().to(dayjs(event.startDate))
    : dayjs().to(dayjs(event.endDate));

const fonts = {
  genshin: "hy-impact-regular",
  starrail: "bai-jamjuree-bold",
  reverse: "playfair-display-sc-bold",
  wuwa: "philosopher-bold",
};
---

<div
  class={`w-full relative p-4 flex flex-col gap-2 rounded-md overflow-hidden ${character.colors.primary} ${fonts[event.game]}`}
>
  <h2 class="text-white text-sm">{character.bannerName}</h2>
  <h3 class={`${character.colors.textAccent} text-xs`}>
    {eventType}
    {timeUntil}
  </h3>
  <Image
    src={images[imagePath]()}
    class="absolute -right-20 top-0 h-full w-auto"
    alt={`${character.name} Banner Card`}
  />
</div>
