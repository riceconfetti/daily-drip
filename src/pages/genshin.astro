---
import Layout from "../layouts/Layout.astro";
import VersionSection from "../components/VersionSection.astro";
import FiveStarCard from "../components/FiveStarCard.astro";
import PhaseRateUps from "../components/PhaseRateUps.astro";
import PhaseCard from "../components/PhaseCard.astro";
import c from "../assets/characters.json";
import { Character } from "../classes/character";
import { getCollection, getEntry } from "astro:content";

const versions = await getCollection("versions", ({ id }) => {
  return id.startsWith("genshin");
});
const banners = (
  await getCollection("banners", ({ id }) => {
    return id.startsWith("genshin");
  })
).sort((a, b) => Date.parse(a.data.time) - Date.parse(b.data.time));

function getDate(v) {
  const phaseOne = banners.filter((banner) => {
    return banner.id.startsWith(`${v.id}`);
  })[0];
  if (phaseOne === undefined) {
    return "";
  } else {
    return phaseOne.data.time;
  }
}

function getCharacter(char, rarity?) {
  if (c[char] === undefined) {
    return { rarity: 5 };
  } else {
    return c[char];
  }
}
---

<Layout title="The Daily Drip | Genshin Banners">
  {
    versions.map((v) => (
      <VersionSection
        version={v.data.version}
        title={v.data.name}
        date={new Date(getDate(v))}
      >
        {banners
          .filter((banner) => {
            return banner.id.startsWith(`${v.id}`);
          })
          .map((b, i) => (
            <PhaseCard number={i + 1} date={new Date(b.data.time)}>
              {b.data.characters.five.map((char) => (
                <FiveStarCard
                  character={
                    new Character(char, getCharacter(char.replace(/\s/g, ""), 5))
                  }
                />
              ))}
              <PhaseRateUps characters={
                b.data.characters.four.map((char)=> (
                  new Character(char, getCharacter(char.replace(/\s/g, ""), 4))
                ))
              } weapons={b.data.weapons}/>
            </PhaseCard>
          ))}
      </VersionSection>
    ))
  }
</Layout>

<style lang="scss"></style>
