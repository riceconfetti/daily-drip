---
import Layout from "../layouts/Layout.astro";
import CalendarWidget from "$components/CalendarWidget.svelte";
import EventsWidget from "$components/EventsWidget.astro";
import { getCollection, getEntry } from "astro:content";

const genshin = (
  await getCollection("events", async ({ data }) => {
    let game = await getEntry(data.game);
    return game.id == "genshin";
  })
).map((e) => e.data.startDate);

const starrail = (
  await getCollection("events", async ({ data }) => {
    let game = await getEntry(data.game);
    return game.id == "starrail";
  })
).map((e) => e.data.startDate);

const reverse = (
  await getCollection("events", async ({ data }) => {
    let game = await getEntry(data.game);
    return game.id == "reverse";
  })
).map((e) => e.data.startDate);

const wuwa = (
  await getCollection("events", async ({ data }) => {
    let game = await getEntry(data.game);
    return game.id == "wuwa";
  })
).map((e) => e.data.startDate);
---

<Layout title="The Daily Drip">
  <div class="p-4 bg-dark bg-opacity-20 rounded-md">
    <p class="playfair-display-regular text-sm">
      Welcome to <span class="font-bold">The Daily Drip</span>, your place for
      gacha game leaks and speculations
    </p>
  </div>
  <CalendarWidget {genshin} {wuwa} {reverse} {starrail} client:load />
  <EventsWidget />
</Layout>
